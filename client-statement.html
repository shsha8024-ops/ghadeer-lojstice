<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© | Ø´Ø±ÙƒØ© Ø§Ù„ØºØ¯ÙŠØ± Ù„Ù„Ù†Ù‚Ù„ ÙˆØ§Ù„ØªØ®Ù„ÙŠØµ Ø§Ù„Ù…ÙƒØ±Ù…ÙŠ</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
<style>
html, body {
  height: 100%;
  margin: 0;
  font-family: "Cairo", sans-serif;
  background: linear-gradient(180deg,#f7faff,#eef5ff);
  color: #000;
  direction: rtl;
  overflow-x: hidden;
}

/* ===== Ø§Ù„Ù‡ÙŠØ¯Ø± ===== */
header {
  position: sticky;
  top: 0;
  z-index: 999;
  background: linear-gradient(90deg,#002b72,#0055a5,#c2a356);
  color: #fff;
  padding: 1rem 2rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 4px 15px rgba(0,0,0,0.15);
  border-bottom: 2px solid #eacb65;
}
.brand {display:flex;align-items:center;gap:12px}
.brand img{width:70px;height:70px;object-fit:contain}
.brand-name span{font-size:1.4rem;font-weight:900}
.brand-name small{color:#fff8d9}
nav ul{display:flex;gap:1.2rem;list-style:none;margin:0;padding:0}
nav a, .nav-btn{
  color:#fff;
  text-decoration:none;
  font-weight:600;
  background: rgba(255,255,255,0.15);
  padding: 6px 12px;
  border-radius: 10px;
  transition: 0.3s;
}
nav a:hover, .nav-btn:hover{background: rgba(255,255,255,0.3);}

/* ===== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ===== */
main {
  min-height: calc(100vh - 180px);
  max-width: 1200px;
  margin: 2rem auto;
  padding: 1rem;
}
h2 {
  text-align: center;
  color: #000;
  border-bottom: 2px solid #c2a356;
  display: inline-block;
  padding-bottom: 6px;
  margin-bottom: 2rem;
}

/* ===== Ø§Ù„Ø¬Ø¯ÙˆÙ„ ===== */
table {
  width: 100%;
  border-collapse: collapse;
  background: #fff;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 3px 15px rgba(0,0,0,0.1);
}
th, td {
  padding: 10px;
  border-bottom: 1px solid #ddd;
  text-align: center;
  color: #000;
}
th {background: #f4f4f4; font-weight: bold;}
tfoot td {
  background: #fffbea;
  font-weight: bold;
}

/* ===== Ø§Ù„Ø£Ø²Ø±Ø§Ø± ===== */
.add-btn {
  display: inline-block;
  margin: 10px;
  padding: 10px 20px;
  border-radius: 10px;
  background: linear-gradient(90deg,#004b95,#008d5f);
  color: #fff;
  border: none;
  cursor: pointer;
  transition: 0.3s;
}
.add-btn:hover {background: #008d5f; transform: translateY(-2px);}
.action-btn {
  display: block;
  width: 100%;
  margin-top: 8px;
  padding: 10px;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s;
}
.edit-btn {background: #00b894; color: #fff;}
.delete-btn {background: #ff3b30; color: #fff;}
.print-btn {background: linear-gradient(90deg,#b9973e,#f0cd63); color: #000;}
.close-btn {background: #ccc; color: #000;}
.action-btn:hover {opacity: 0.85;}

/* ===== Ø§Ù„Ù†ÙˆØ§ÙØ° ===== */
.modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.3);
  backdrop-filter: blur(5px);
  justify-content: center;
  align-items: center;
  z-index: 999;
}
.modal-content {
  background: #fff;
  border-radius: 14px;
  padding: 1.8rem;
  width: 90%;
  max-width: 480px;
  color: #000;
  box-shadow: 0 6px 20px rgba(0,0,0,0.2);
}
.modal-content input, select {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  border-radius: 8px;
  border: 1px solid #ccc;
  background: #fff;
  color: #000;
}
.modal-content input:focus, select:focus {
  border-color: #c2a356;
  box-shadow: 0 0 0 3px rgba(194,163,86,0.25);
  outline: none;
}

/* ===== Ø§Ù„ÙÙˆØªØ± ===== */
footer {
  background: #fafafa;
  text-align: center;
  padding: 1.5rem;
  color: #000;
  border-top: 1px solid #ddd;
}
</style>
</head>
<body>

<header>
  <div class="brand">
    <img src="ghadeer-logo.png" alt="ghadeer logo">
    <div class="brand-name">
      <span>Ø´Ø±ÙƒØ© Ø§Ù„ØºØ¯ÙŠØ±</span><br>
      <small>Ù„Ù„Ù†Ù‚Ù„ ÙˆØ§Ù„ØªØ®Ù„ÙŠØµ Ø§Ù„Ù…ÙƒØ±Ù…ÙŠ</small>
    </div>
  </div>
  <nav>
    <button class="nav-btn" onclick="history.back()">ğŸ”™ Ø±Ø¬ÙˆØ¹</button>
    <button class="nav-btn" onclick="window.location.href='home.html'">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
  </nav>
</header>

<main>
  <h2 id="invTitle">ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</h2>
  <button class="add-btn" onclick="openModal()">+ Ø¥Ø¶Ø§ÙØ© ÙˆØµÙ„ Ø¬Ø¯ÙŠØ¯</button>

  <table>
    <thead>
      <tr>
        <th>Ø±Ù‚Ù… Ø§Ù„ÙˆØµÙ„</th>
        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
        <th>Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚</th>
        <th>Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
        <th>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</th>
        <th>Ù…Ù„Ø§Ø­Ø¸Ø©</th>
        <th>Ø§Ù„Ù…Ø¨Ù„Øº ($)</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
    <tfoot>
      <tr><td colspan="6">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØµÙˆÙ„Ø§Øª</td><td id="total">0$</td></tr>
    </tfoot>
  </table>
</main>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¶Ø§ÙØ© / Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ -->
<div id="modal" class="modal">
  <div class="modal-content">
    <h3 id="modalTitle">Ø¥Ø¶Ø§ÙØ© ÙˆØµÙ„ Ø¬Ø¯ÙŠØ¯</h3>
    <label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
    <input type="date" id="rDate">
    <label>Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚</label>
    <input type="text" id="rDriver">
    <label>Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©</label>
    <input type="text" id="rCar">
    <label>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</label>
    <select id="rCity">
      <option>Ø£Ø±Ø¨ÙŠÙ„</option>
      <option>Ø¯Ù‡ÙˆÙƒ</option>
      <option>Ø³Ù„ÙŠÙ…Ø§Ù†ÙŠØ©</option>
      <option>Ù†ÙŠÙ†ÙˆÙ‰</option>
      <option>Ø£Ù†Ø¨Ø§Ø±</option>
    </select>
    <label>Ù…Ù„Ø§Ø­Ø¸Ø©</label>
    <input type="text" id="rNote">
    <label>Ø§Ù„Ù…Ø¨Ù„Øº ($)</label>
    <input type="number" id="rAmount" value="0">
    <button class="add-btn" id="saveBtn" onclick="saveReceipt()">Ø­ÙØ¸ Ø§Ù„ÙˆØµÙ„</button>
    <button class="close-btn action-btn" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
  </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø© -->
<div id="viewModal" class="modal">
  <div class="modal-content">
    <div style="text-align:center;border-bottom:2px solid #c2a356;padding-bottom:10px;">
      <img src="ghadeer-logo.png" style="width:80px;height:80px;"><br>
      <strong style="font-size:1.2rem;color:#004b95;">Ø´Ø±ÙƒØ© Ø§Ù„ØºØ¯ÙŠØ± Ù„Ù„Ù†Ù‚Ù„ ÙˆØ§Ù„ØªØ®Ù„ÙŠØµ Ø§Ù„Ù…ÙƒØ±Ù…ÙŠ</strong><br>
      <span style="color:#c2a356;">ÙˆØµÙ„ Ø±Ø³Ù…ÙŠ</span>
    </div>
    <div id="receiptDetails" style="margin-top:10px;line-height:1.8;text-align:right;"></div>
    <button class="edit-btn action-btn" onclick="editCurrent()">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙˆØµÙ„</button>
    <button class="delete-btn action-btn" onclick="deleteCurrent()">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ÙˆØµÙ„</button>
    <button class="print-btn action-btn" onclick="window.location.href='invoice-pdf.html'">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© PDF</button>
    <button class="close-btn action-btn" onclick="closeView()">âŒ Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
</div>

<footer>
  Â© 2026 Ø´Ø±ÙƒØ© Ø§Ù„ØºØ¯ÙŠØ± Ù„Ù„Ù†Ù‚Ù„ ÙˆØ§Ù„ØªØ®Ù„ÙŠØµ Ø§Ù„Ù…ÙƒØ±Ù…ÙŠ â€“ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©
</footer>

<script>
const invId = new URLSearchParams(window.location.search).get('id') || 'ÙØ§ØªÙˆØ±Ø©-001';
document.getElementById('invTitle').textContent = `ØªÙØ§ØµÙŠÙ„ ${invId}`;

let invoices = JSON.parse(localStorage.getItem('ghadeerInvoices') || '[]');
let invoice = invoices.find(i => i.id === invId);
if (!invoice) {
  invoice = { id: invId, receipts: [], total: 0 };
  invoices.push(invoice);
}
let editIndex = null;
let currentView = null;

function render() {
  const tbody = document.getElementById('tbody');
  tbody.innerHTML = '';
  let total = 0;
  invoice.receipts.forEach((r, i) => {
    total += r.amount;
    tbody.innerHTML += `
      <tr>
        <td style="cursor:pointer;color:#004b95;" onclick="viewReceipt(${i})">${r.id}</td>
        <td>${r.date}</td>
        <td>${r.driver}</td>
        <td>${r.car}</td>
        <td>${r.city}</td>
        <td>${r.note}</td>
        <td>${r.amount.toFixed(2)}$</td>
      </tr>`;
  });
  document.getElementById('total').textContent = total.toFixed(2) + '$';
  invoice.total = total;
  localStorage.setItem('ghadeerInvoices', JSON.stringify(invoices));
}

function openModal() {
  editIndex = null;
  document.getElementById('modalTitle').textContent = 'Ø¥Ø¶Ø§ÙØ© ÙˆØµÙ„ Ø¬Ø¯ÙŠØ¯';
  document.getElementById('saveBtn').textContent = 'Ø­ÙØ¸ Ø§Ù„ÙˆØµÙ„';
  document.getElementById('rDate').value = new Date().toISOString().split('T')[0];
  document.getElementById('rDriver').value = '';
  document.getElementById('rCar').value = '';
  document.getElementById('rCity').value = 'Ø£Ø±Ø¨ÙŠÙ„';
  document.getElementById('rNote').value = '';
  document.getElementById('rAmount').value = 0;
  document.getElementById('modal').style.display = 'flex';
}
function closeModal() { document.getElementById('modal').style.display = 'none'; }

function saveReceipt() {
  const date = document.getElementById('rDate').value;
  const driver = document.getElementById('rDriver').value.trim();
  const car = document.getElementById('rCar').value.trim();
  const city = document.getElementById('rCity').value;
  const note = document.getElementById('rNote').value.trim() || 'â€”';
  const amount = parseFloat(document.getElementById('rAmount').value) || 0;
  if (!driver || !car) return alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚ ÙˆØ±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©');

  if (editIndex !== null) {
    invoice.receipts[editIndex] = { ...invoice.receipts[editIndex], date, driver, car, city, note, amount };
  } else {
    const nextId = 'RCPT-' + String(invoice.receipts.length + 1).padStart(3, '0');
    invoice.receipts.push({ id: nextId, date, driver, car, city, note, amount });
  }

  localStorage.setItem('ghadeerInvoices', JSON.stringify(invoices));
  closeModal();
  render();
}

function viewReceipt(i) {
  currentView = i;
  const r = invoice.receipts[i];
  localStorage.setItem('selectedReceipt', JSON.stringify({ invoiceId: invId, ...r, total: invoice.total }));
  document.getElementById('receiptDetails').innerHTML = `
    <b>Ø±Ù‚Ù… Ø§Ù„ÙˆØµÙ„:</b> ${r.id}<br>
    <b>Ø§Ù„ØªØ§Ø±ÙŠØ®:</b> ${r.date}<br>
    <b>Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚:</b> ${r.driver}<br>
    <b>Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©:</b> ${r.car}<br>
    <b>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©:</b> ${r.city}<br>
    <b>Ù…Ù„Ø§Ø­Ø¸Ø©:</b> ${r.note}<br>
    <b>Ø§Ù„Ù…Ø¨Ù„Øº:</b> ${r.amount.toFixed(2)}$
  `;
  document.getElementById('viewModal').style.display = 'flex';
}

function editCurrent() {
  if (currentView === null) return;
  const r = invoice.receipts[currentView];
  editIndex = currentView;
  closeView();
  document.getElementById('rDate').value = r.date;
  document.getElementById('rDriver').value = r.driver;
  document.getElementById('rCar').value = r.car;
  document.getElementById('rCity').value = r.city;
  document.getElementById('rNote').value = r.note;
  document.getElementById('rAmount').value = r.amount;
  document.getElementById('modalTitle').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙˆØµÙ„';
  document.getElementById('saveBtn').textContent = 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª';
  document.getElementById('modal').style.display = 'flex';
}

function deleteCurrent() {
  if (currentView === null) return;
  if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ÙˆØµÙ„ØŸ')) {
    invoice.receipts.splice(currentView, 1);
    localStorage.setItem('ghadeerInvoices', JSON.stringify(invoices));
    closeView();
    render();
  }
}

function printReceipt() {
  window.open('receipt-print.html', '_blank');
}

function closeView() { document.getElementById('viewModal').style.display = 'none'; }

render();




</script>
</body>
</html>